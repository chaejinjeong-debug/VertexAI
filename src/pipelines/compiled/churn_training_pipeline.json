{
  "components": {
    "comp-data-load-op": {
      "executorLabel": "exec-data-load-op",
      "inputDefinitions": {
        "parameters": {
          "input_bq_table": {
            "parameterType": "STRING"
          },
          "label_column": {
            "parameterType": "STRING"
          },
          "time_column": {
            "parameterType": "STRING"
          },
          "train_ratio": {
            "parameterType": "NUMBER_DOUBLE"
          },
          "valid_ratio": {
            "parameterType": "NUMBER_DOUBLE"
          }
        }
      },
      "outputDefinitions": {
        "artifacts": {
          "output_dataset": {
            "artifactType": {
              "schemaTitle": "system.Artifact",
              "schemaVersion": "0.0.1"
            }
          }
        }
      }
    },
    "comp-eval-op": {
      "executorLabel": "exec-eval-op",
      "inputDefinitions": {
        "artifacts": {
          "input_dataset": {
            "artifactType": {
              "schemaTitle": "system.Artifact",
              "schemaVersion": "0.0.1"
            }
          },
          "input_model": {
            "artifactType": {
              "schemaTitle": "system.Artifact",
              "schemaVersion": "0.0.1"
            }
          }
        },
        "parameters": {
          "eval_split": {
            "parameterType": "STRING"
          },
          "feature_columns": {
            "parameterType": "STRING"
          },
          "label_column": {
            "parameterType": "STRING"
          }
        }
      },
      "outputDefinitions": {
        "artifacts": {
          "output_metrics": {
            "artifactType": {
              "schemaTitle": "system.Artifact",
              "schemaVersion": "0.0.1"
            }
          }
        }
      }
    },
    "comp-eval-op-2": {
      "executorLabel": "exec-eval-op-2",
      "inputDefinitions": {
        "artifacts": {
          "input_dataset": {
            "artifactType": {
              "schemaTitle": "system.Artifact",
              "schemaVersion": "0.0.1"
            }
          },
          "input_model": {
            "artifactType": {
              "schemaTitle": "system.Artifact",
              "schemaVersion": "0.0.1"
            }
          }
        },
        "parameters": {
          "eval_split": {
            "parameterType": "STRING"
          },
          "feature_columns": {
            "parameterType": "STRING"
          },
          "label_column": {
            "parameterType": "STRING"
          }
        }
      },
      "outputDefinitions": {
        "artifacts": {
          "output_metrics": {
            "artifactType": {
              "schemaTitle": "system.Artifact",
              "schemaVersion": "0.0.1"
            }
          }
        }
      }
    },
    "comp-model-upload-op": {
      "executorLabel": "exec-model-upload-op",
      "inputDefinitions": {
        "artifacts": {
          "input_metrics": {
            "artifactType": {
              "schemaTitle": "system.Artifact",
              "schemaVersion": "0.0.1"
            }
          },
          "input_model": {
            "artifactType": {
              "schemaTitle": "system.Artifact",
              "schemaVersion": "0.0.1"
            }
          }
        },
        "parameters": {
          "experiment_name": {
            "parameterType": "STRING"
          },
          "model_display_name": {
            "parameterType": "STRING"
          },
          "project_id": {
            "parameterType": "STRING"
          },
          "region": {
            "parameterType": "STRING"
          }
        }
      },
      "outputDefinitions": {
        "artifacts": {
          "output_model_resource": {
            "artifactType": {
              "schemaTitle": "system.Artifact",
              "schemaVersion": "0.0.1"
            }
          }
        }
      }
    },
    "comp-train-op": {
      "executorLabel": "exec-train-op",
      "inputDefinitions": {
        "artifacts": {
          "input_dataset": {
            "artifactType": {
              "schemaTitle": "system.Artifact",
              "schemaVersion": "0.0.1"
            }
          }
        },
        "parameters": {
          "base_output_directory": {
            "defaultValue": "",
            "isOptional": true,
            "parameterType": "STRING"
          },
          "display_name": {
            "defaultValue": "churn-model-training",
            "isOptional": true,
            "parameterType": "STRING"
          },
          "enable_web_access": {
            "defaultValue": false,
            "isOptional": true,
            "parameterType": "BOOLEAN"
          },
          "encryption_spec_key_name": {
            "defaultValue": "",
            "isOptional": true,
            "parameterType": "STRING"
          },
          "feature_columns": {
            "parameterType": "STRING"
          },
          "label_column": {
            "parameterType": "STRING"
          },
          "labels": {
            "isOptional": true,
            "parameterType": "STRUCT"
          },
          "location": {
            "defaultValue": "{{$.pipeline_google_cloud_location}}",
            "isOptional": true,
            "parameterType": "STRING"
          },
          "max_depth": {
            "parameterType": "NUMBER_INTEGER"
          },
          "max_wait_duration": {
            "defaultValue": "86400s",
            "isOptional": true,
            "parameterType": "STRING"
          },
          "model_type": {
            "parameterType": "STRING"
          },
          "n_estimators": {
            "parameterType": "NUMBER_INTEGER"
          },
          "network": {
            "defaultValue": "",
            "isOptional": true,
            "parameterType": "STRING"
          },
          "persistent_resource_id": {
            "defaultValue": "{{$.pipeline_persistent_resource_id}}",
            "isOptional": true,
            "parameterType": "STRING"
          },
          "project": {
            "defaultValue": "{{$.pipeline_google_cloud_project_id}}",
            "isOptional": true,
            "parameterType": "STRING"
          },
          "psc_interface_config": {
            "isOptional": true,
            "parameterType": "STRUCT"
          },
          "random_state": {
            "parameterType": "NUMBER_INTEGER"
          },
          "reserved_ip_ranges": {
            "isOptional": true,
            "parameterType": "LIST"
          },
          "restart_job_on_worker_restart": {
            "defaultValue": false,
            "isOptional": true,
            "parameterType": "BOOLEAN"
          },
          "service_account": {
            "defaultValue": "",
            "isOptional": true,
            "parameterType": "STRING"
          },
          "strategy": {
            "defaultValue": "STANDARD",
            "isOptional": true,
            "parameterType": "STRING"
          },
          "tensorboard": {
            "defaultValue": "",
            "isOptional": true,
            "parameterType": "STRING"
          },
          "timeout": {
            "defaultValue": "604800s",
            "isOptional": true,
            "parameterType": "STRING"
          },
          "worker_pool_specs": {
            "defaultValue": [
              {
                "container_spec": {
                  "args": [
                    "--input_dataset_dir",
                    "{{$.inputs.artifacts['input_dataset'].path}}",
                    "--output_model_dir",
                    "{{$.outputs.artifacts['output_model'].path}}",
                    "--feature_columns",
                    "{{$.inputs.parameters['feature_columns']}}",
                    "--label_column",
                    "{{$.inputs.parameters['label_column']}}",
                    "--model_type",
                    "{{$.inputs.parameters['model_type']}}",
                    "--n_estimators",
                    "{{$.inputs.parameters['n_estimators']}}",
                    "--max_depth",
                    "{{$.inputs.parameters['max_depth']}}",
                    "--random_state",
                    "{{$.inputs.parameters['random_state']}}"
                  ],
                  "command": [
                    "python",
                    "/app/src/main.py"
                  ],
                  "env": [],
                  "image_uri": "asia-northeast3-docker.pkg.dev/heum-alfred-evidence-clf-dev/vertex-ai-pipelines/component-train:latest"
                },
                "disk_spec": {
                  "boot_disk_size_gb": 100.0,
                  "boot_disk_type": "pd-ssd"
                },
                "machine_spec": {
                  "machine_type": "n1-standard-4"
                },
                "replica_count": 1.0
              }
            ],
            "isOptional": true,
            "parameterType": "LIST"
          }
        }
      },
      "outputDefinitions": {
        "artifacts": {
          "output_model": {
            "artifactType": {
              "schemaTitle": "system.Artifact",
              "schemaVersion": "0.0.1"
            }
          }
        },
        "parameters": {
          "gcp_resources": {
            "parameterType": "STRING"
          }
        }
      }
    }
  },
  "deploymentSpec": {
    "executors": {
      "exec-data-load-op": {
        "container": {
          "args": [
            "--input_bq_table",
            "{{$.inputs.parameters['input_bq_table']}}",
            "--output_dataset_dir",
            "{{$.outputs.artifacts['output_dataset'].path}}",
            "--label_column",
            "{{$.inputs.parameters['label_column']}}",
            "--time_column",
            "{{$.inputs.parameters['time_column']}}",
            "--train_ratio",
            "{{$.inputs.parameters['train_ratio']}}",
            "--valid_ratio",
            "{{$.inputs.parameters['valid_ratio']}}"
          ],
          "command": [
            "python",
            "/app/src/main.py"
          ],
          "image": "asia-northeast3-docker.pkg.dev/heum-alfred-evidence-clf-dev/vertex-ai-pipelines/component-data_load:latest"
        }
      },
      "exec-eval-op": {
        "container": {
          "args": [
            "--input_model_dir",
            "{{$.inputs.artifacts['input_model'].path}}",
            "--input_dataset_dir",
            "{{$.inputs.artifacts['input_dataset'].path}}",
            "--output_metrics_path",
            "{{$.outputs.artifacts['output_metrics'].path}}",
            "--feature_columns",
            "{{$.inputs.parameters['feature_columns']}}",
            "--label_column",
            "{{$.inputs.parameters['label_column']}}",
            "--eval_split",
            "{{$.inputs.parameters['eval_split']}}"
          ],
          "command": [
            "python",
            "/app/src/main.py"
          ],
          "image": "asia-northeast3-docker.pkg.dev/heum-alfred-evidence-clf-dev/vertex-ai-pipelines/component-eval:latest"
        }
      },
      "exec-eval-op-2": {
        "container": {
          "args": [
            "--input_model_dir",
            "{{$.inputs.artifacts['input_model'].path}}",
            "--input_dataset_dir",
            "{{$.inputs.artifacts['input_dataset'].path}}",
            "--output_metrics_path",
            "{{$.outputs.artifacts['output_metrics'].path}}",
            "--feature_columns",
            "{{$.inputs.parameters['feature_columns']}}",
            "--label_column",
            "{{$.inputs.parameters['label_column']}}",
            "--eval_split",
            "{{$.inputs.parameters['eval_split']}}"
          ],
          "command": [
            "python",
            "/app/src/main.py"
          ],
          "image": "asia-northeast3-docker.pkg.dev/heum-alfred-evidence-clf-dev/vertex-ai-pipelines/component-eval:latest"
        }
      },
      "exec-model-upload-op": {
        "container": {
          "args": [
            "--input_model_dir",
            "{{$.inputs.artifacts['input_model'].path}}",
            "--input_metrics_path",
            "{{$.inputs.artifacts['input_metrics'].path}}",
            "--project_id",
            "{{$.inputs.parameters['project_id']}}",
            "--region",
            "{{$.inputs.parameters['region']}}",
            "--experiment_name",
            "{{$.inputs.parameters['experiment_name']}}",
            "--model_display_name",
            "{{$.inputs.parameters['model_display_name']}}",
            "--output_model_resource",
            "{{$.outputs.artifacts['output_model_resource'].path}}"
          ],
          "command": [
            "python",
            "/app/src/main.py"
          ],
          "image": "asia-northeast3-docker.pkg.dev/heum-alfred-evidence-clf-dev/vertex-ai-pipelines/component-model_upload:latest"
        }
      },
      "exec-train-op": {
        "container": {
          "args": [
            "--type",
            "CustomJob",
            "--payload",
            "{\"display_name\": \"{{$.inputs.parameters['display_name']}}\", \"job_spec\": {\"worker_pool_specs\": {{$.inputs.parameters['worker_pool_specs']}}, \"scheduling\": {\"timeout\": \"{{$.inputs.parameters['timeout']}}\", \"restart_job_on_worker_restart\": {{$.inputs.parameters['restart_job_on_worker_restart']}}, \"strategy\": \"{{$.inputs.parameters['strategy']}}\", \"max_wait_duration\": \"{{$.inputs.parameters['max_wait_duration']}}\"}, \"service_account\": \"{{$.inputs.parameters['service_account']}}\", \"tensorboard\": \"{{$.inputs.parameters['tensorboard']}}\", \"enable_web_access\": {{$.inputs.parameters['enable_web_access']}}, \"network\": \"{{$.inputs.parameters['network']}}\", \"reserved_ip_ranges\": {{$.inputs.parameters['reserved_ip_ranges']}}, \"base_output_directory\": {\"output_uri_prefix\": \"{{$.inputs.parameters['base_output_directory']}}\"}, \"persistent_resource_id\": \"{{$.inputs.parameters['persistent_resource_id']}}\", \"psc_interface_config\": {{$.inputs.parameters['psc_interface_config']}}}, \"labels\": {{$.inputs.parameters['labels']}}, \"encryption_spec\": {\"kms_key_name\": \"{{$.inputs.parameters['encryption_spec_key_name']}}\"}}",
            "--project",
            "{{$.inputs.parameters['project']}}",
            "--location",
            "{{$.inputs.parameters['location']}}",
            "--gcp_resources",
            "{{$.outputs.parameters['gcp_resources'].output_file}}"
          ],
          "command": [
            "python3",
            "-u",
            "-m",
            "google_cloud_pipeline_components.container.v1.custom_job.launcher"
          ],
          "image": "gcr.io/ml-pipeline/google-cloud-pipeline-components:2.22.0"
        }
      }
    }
  },
  "pipelineInfo": {
    "description": "Customer Churn \uc608\uce21 \ubaa8\ub378 \ud559\uc2b5 \ud30c\uc774\ud504\ub77c\uc778 (Container-based)",
    "name": "customer-churn-training-pipeline"
  },
  "root": {
    "dag": {
      "tasks": {
        "data-load-op": {
          "cachingOptions": {
            "enableCache": true
          },
          "componentRef": {
            "name": "comp-data-load-op"
          },
          "inputs": {
            "parameters": {
              "input_bq_table": {
                "componentInputParameter": "input_bq_table"
              },
              "label_column": {
                "componentInputParameter": "label_column"
              },
              "time_column": {
                "componentInputParameter": "time_column"
              },
              "train_ratio": {
                "componentInputParameter": "train_ratio"
              },
              "valid_ratio": {
                "componentInputParameter": "valid_ratio"
              }
            }
          },
          "taskInfo": {
            "name": "Data Load"
          }
        },
        "eval-op": {
          "cachingOptions": {
            "enableCache": true
          },
          "componentRef": {
            "name": "comp-eval-op"
          },
          "dependentTasks": [
            "data-load-op",
            "train-op"
          ],
          "inputs": {
            "artifacts": {
              "input_dataset": {
                "taskOutputArtifact": {
                  "outputArtifactKey": "output_dataset",
                  "producerTask": "data-load-op"
                }
              },
              "input_model": {
                "taskOutputArtifact": {
                  "outputArtifactKey": "output_model",
                  "producerTask": "train-op"
                }
              }
            },
            "parameters": {
              "eval_split": {
                "runtimeValue": {
                  "constant": "valid"
                }
              },
              "feature_columns": {
                "runtimeValue": {
                  "constant": "orders_30d,orders_90d,revenue_30d,revenue_90d,avg_order_value_90d,distinct_products_90d,distinct_categories_90d,days_since_last_order"
                }
              },
              "label_column": {
                "componentInputParameter": "label_column"
              }
            }
          },
          "taskInfo": {
            "name": "Evaluate (Valid)"
          }
        },
        "eval-op-2": {
          "cachingOptions": {
            "enableCache": true
          },
          "componentRef": {
            "name": "comp-eval-op-2"
          },
          "dependentTasks": [
            "data-load-op",
            "train-op"
          ],
          "inputs": {
            "artifacts": {
              "input_dataset": {
                "taskOutputArtifact": {
                  "outputArtifactKey": "output_dataset",
                  "producerTask": "data-load-op"
                }
              },
              "input_model": {
                "taskOutputArtifact": {
                  "outputArtifactKey": "output_model",
                  "producerTask": "train-op"
                }
              }
            },
            "parameters": {
              "eval_split": {
                "runtimeValue": {
                  "constant": "test"
                }
              },
              "feature_columns": {
                "runtimeValue": {
                  "constant": "orders_30d,orders_90d,revenue_30d,revenue_90d,avg_order_value_90d,distinct_products_90d,distinct_categories_90d,days_since_last_order"
                }
              },
              "label_column": {
                "componentInputParameter": "label_column"
              }
            }
          },
          "taskInfo": {
            "name": "Evaluate (Test)"
          }
        },
        "model-upload-op": {
          "cachingOptions": {
            "enableCache": true
          },
          "componentRef": {
            "name": "comp-model-upload-op"
          },
          "dependentTasks": [
            "eval-op",
            "train-op"
          ],
          "inputs": {
            "artifacts": {
              "input_metrics": {
                "taskOutputArtifact": {
                  "outputArtifactKey": "output_metrics",
                  "producerTask": "eval-op"
                }
              },
              "input_model": {
                "taskOutputArtifact": {
                  "outputArtifactKey": "output_model",
                  "producerTask": "train-op"
                }
              }
            },
            "parameters": {
              "experiment_name": {
                "componentInputParameter": "experiment_name"
              },
              "model_display_name": {
                "componentInputParameter": "model_display_name"
              },
              "project_id": {
                "componentInputParameter": "project_id"
              },
              "region": {
                "componentInputParameter": "region"
              }
            }
          },
          "taskInfo": {
            "name": "Model Upload"
          }
        },
        "train-op": {
          "cachingOptions": {
            "enableCache": true
          },
          "componentRef": {
            "name": "comp-train-op"
          },
          "dependentTasks": [
            "data-load-op"
          ],
          "inputs": {
            "artifacts": {
              "input_dataset": {
                "taskOutputArtifact": {
                  "outputArtifactKey": "output_dataset",
                  "producerTask": "data-load-op"
                }
              }
            },
            "parameters": {
              "feature_columns": {
                "runtimeValue": {
                  "constant": "orders_30d,orders_90d,revenue_30d,revenue_90d,avg_order_value_90d,distinct_products_90d,distinct_categories_90d,days_since_last_order"
                }
              },
              "label_column": {
                "componentInputParameter": "label_column"
              },
              "location": {
                "componentInputParameter": "region"
              },
              "max_depth": {
                "componentInputParameter": "max_depth"
              },
              "model_type": {
                "componentInputParameter": "model_type"
              },
              "n_estimators": {
                "componentInputParameter": "n_estimators"
              },
              "project": {
                "componentInputParameter": "project_id"
              },
              "random_state": {
                "componentInputParameter": "random_state"
              }
            }
          },
          "taskInfo": {
            "name": "Train Model (CustomJob)"
          }
        }
      }
    },
    "inputDefinitions": {
      "parameters": {
        "experiment_name": {
          "defaultValue": "churn-experiment",
          "description": "Vertex AI Experiment name for tracking",
          "isOptional": true,
          "parameterType": "STRING"
        },
        "input_bq_table": {
          "defaultValue": "heum-alfred-evidence-clf-dev.featurestore_demo.train_dataset",
          "description": "BigQuery table path for training data",
          "isOptional": true,
          "parameterType": "STRING"
        },
        "label_column": {
          "defaultValue": "label_churn_60d",
          "description": "Name of the label column",
          "isOptional": true,
          "parameterType": "STRING"
        },
        "max_depth": {
          "defaultValue": 10.0,
          "description": "Maximum tree depth",
          "isOptional": true,
          "parameterType": "NUMBER_INTEGER"
        },
        "model_display_name": {
          "defaultValue": "churn-model",
          "description": "Display name for Model Registry",
          "isOptional": true,
          "parameterType": "STRING"
        },
        "model_type": {
          "defaultValue": "random_forest",
          "description": "Type of model (random_forest or logistic_regression)",
          "isOptional": true,
          "parameterType": "STRING"
        },
        "n_estimators": {
          "defaultValue": 100.0,
          "description": "Number of trees for RandomForest",
          "isOptional": true,
          "parameterType": "NUMBER_INTEGER"
        },
        "project_id": {
          "defaultValue": "heum-alfred-evidence-clf-dev",
          "description": "GCP project ID",
          "isOptional": true,
          "parameterType": "STRING"
        },
        "random_state": {
          "defaultValue": 42.0,
          "description": "Random seed for reproducibility",
          "isOptional": true,
          "parameterType": "NUMBER_INTEGER"
        },
        "region": {
          "defaultValue": "asia-northeast3",
          "description": "GCP region",
          "isOptional": true,
          "parameterType": "STRING"
        },
        "time_column": {
          "defaultValue": "label_timestamp",
          "description": "Name of the timestamp column for time-based split",
          "isOptional": true,
          "parameterType": "STRING"
        },
        "train_ratio": {
          "defaultValue": 0.7,
          "description": "Proportion of data for training",
          "isOptional": true,
          "parameterType": "NUMBER_DOUBLE"
        },
        "valid_ratio": {
          "defaultValue": 0.15,
          "description": "Proportion of data for validation",
          "isOptional": true,
          "parameterType": "NUMBER_DOUBLE"
        }
      }
    }
  },
  "schemaVersion": "2.1.0",
  "sdkVersion": "kfp-2.15.2"
}